# 4. 람다 함수에서 EFS 파일 시스템 사용

<br>

### 실습

---

**목표**

기존 서버가 사용하는 네트워크 파일 시스템에 람다가 접근할 수 있어야 한다.

<br>

**해결**

람다함수를 아래 그림과 같이 생성하고 EFS파일 시스템을 마운트

![image](https://user-images.githubusercontent.com/49095587/226170275-d31732c6-f20e-4420-94e9-5ac9e12243cf.png)

<br>

1. 람다 함수가 사용할 새 보안 그룹 생성
2. EFS 파일 시스템의 보안 그룹에 람다 함수의 보안 그룹의 TCP 포트 2049에 대한 액세스를 허용하는 수신 규칙을 추가
   1. TCP 포트 2049는 Network File System의 기본 포트
3. IAM 역할을 생성
4. 람다 함수가 VPC 내에서 실행할 수 있도록 `AWSLambdaVPCAccessExecutionRole`IAM 관리형 정책을 IAM 역할에 연결
5. 람다 함수가 들은 python 파일을 압축
6. EFS 파일 시스템의 `ACCESS_POINT_ARN`을 사용해 람다 함수를 생성
7. `aws lambda get-function`명령어를 사용해 람다 함수가 활성화되는 것을 확인

<br>

**유효성 검사**

람다 함수를 실행해 파일을 확인 `aws lambda invoke`

<br><br>

### 정리

---

- 서버리스 컴퓨팅과 서버리스 영구 저장소(파일 시스템 및 데이터베이스 모두)를 함께 사용해 컴퓨팅 및 스토리지 운영 오버헤드를 크게 줄일 수 있다.
- 많은 애플리케이션이 S3와 같은 객체 스타일 스토리지 서비스를 사용하지만 그 외의 애플리케이션은 전통적인 파일 스타일 스토리지 서비스를 사용

EFS를 AWS Lambda를 통합해 다음과 같은 솔루션 구축

- 애플리케이션을 위한 영구 스토리지
- 유지 보수
- 이벤트 기반 알림
- 이벤트 기반 파일 처리

<br><br>

### Lambda ENI

---

- Lambda Elastic Network Interface
- 람다 함수를 VPC에 연결하기 위해 사용되는 네트워크 인터페이스
- VPC에서 람다 함수가 실행되도록 구성할 때 사용
