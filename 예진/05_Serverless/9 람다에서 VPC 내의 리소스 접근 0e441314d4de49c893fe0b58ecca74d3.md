# 9. 람다에서 VPC 내의 리소스 접근

<br>

### 실습

---

**목표** : 람다 함수를 사용해 VPC 내의 ElastiCache 클러스터에 접근할 수 있어야 한다.

**해결**

Redis(캐싱 용도로 사용가능한 키-값 데이터 저장소) 클라이언트 연결 및 패키지를 포함한 람다 함수 생성 →VPC 서브넷 및 보안 그룹 지정 → ElastiCache 서브넷 그룹과 ElastiCache 클러스터를 생성 → Redis 클러스터 엔드포인트를 사용하는 람다 함수를 호출

1. 람다 함수가 VPC 내에서 실행할 수 있는 기능을 부여하는데 필요한 `LambdaVPCAccess` IAM 관리형 정책을 IAM 역할에 연결
2. 현재 디렉터리에 Redis Python 패키지 설치
3. 함수 코드 압축 : uuid 값 받는..
4. 람다에 대한 보안 그룹 생성
5. HTTP 요청에 응답할 람다 함수를 생성
6. ElastiCache 서브넷 그룹을 생성 `aws elasticache create-cache-subnet-group`
7. 하나의 노드를 가진 ElastiCache Redis 클러스터를 생성
8. HOSTNAME을 클러스터의 엔드포인트를 사용하도록 함수를 호출

<br>

### ElastiCache 클러스터

---

- 완전 관리형 인메모리 데이터 스토어 및 캐시 서비스
- 인터넷 기반 애플리케이션의 데이터 액세스 성능을 높이고 애플리케이션 부하를 줄일 수 있다.
- Redis(키-값 데이터 저장소) 또는 Memcached(메모리 기반의 객체 캐시 서버) 엔진을 사용하여 구성된다.
- 데이터의 일관성과 가용성을 제공하는 여러 노드를 사용하여 데이터를 저장하며, 노드 중 하나가 장애가 발생하면 다른 노드에서 데이터를 복원
- 캐시 서버 또는 데이터베이스를 호스팅할 수 있다. → 응답 시간 단축, 스케일링 및 확장성 개선

**ElastiCache 서브넷 그룹**

- ElastiCache 클러스터를 배치하는데 사용되는 VPC 서브넷의 논리적인 그룹
- 클러스터를 생성할 때, 서브넷 그룹을 지정하여 클러스터를 VPC 내에 배치
- VPC 내 여러 가용 영역에 걸쳐있는 두 개 이상의 서브넷으로 구성

<br>

### 정리

---

- 람다 함수는 기본적으로 AWS VPC에 액세스가 불가하다, 그치만 VPC에서 네트워크 인터페이스를 프로비저닝하면 람다와 VPC연결이 가능!
- ElastiCache는 VPC에 네트워크 인터페이스를 가진 컴퓨팅 노드가 필요하므로 ElastiCache 노드에 액세스 하려면 람다를 VPC 내에 생성해야 한다.
- (람다)함수가 사용하는 메모리는 실행환경이 끝나고 다시 시작할 때까지 유지되지 않는데, 애플리케이션에서 메모리 지속성에 대한 액세스가 필요한 경우 (HTTP 세션 같은) ElastiCache의 Redis 또는 memcached를 사용해 세션 스토리지 및 키/값 스토리지를 구현할 수 있다.
  - 빠른 읽기/쓰기를 위해 인 메모리 캐시를 구현하면서 애플리케이션에 필요한 메모리 지속성을 유지하면서 애플리케이션을 수평적으로 확장할 수 있도록 도와준다.

<br>

**실습 한번더 정리**

- redis를 사용해 세션이나 키/값 스토리지를 캐싱하는 elasticache 서비스를 람다 함수로 사용하자 하는 상황이다.
- elastiCache는 VPC안에 ENI 노드가 필요한데, 이 노드에 람다가 접근해서 서비스를 사용해야 하므로 람다 역시 VPC안에 생성되어야 한다.
- 그리고 람다가 elastiCache 클러스터에 있는 redis 클러스터 엔드포인트 접근할 수 있도록하여 람다가 ElastiCache(redis에 있는 데이터를 캐싱할 수 있는 서비스)를 사용할 수 있도록 한다.
