# 6. 컨테이너 이미지를 람다에 배포

<br>

### 실습

---

기존의 컨테이너 기반 개발 프로세스와 도구를 사용해 서버리스 함수를 배포해보자

도커 이미지 생성 → ECR 리포지토리로 푸시 → **패키지 유형의 이미지**와 **ECR의 이미지의 URL**을 참고해서 람다 함수를 생성

준비 사항

- ECR 저장소
- 람다 함수 실행을 위한 IAM 역할
- 도커 빌드 환경

1. ECR 로그인 정보를 가져와 도커에 전달 : `aws ecr get-login-password`
2. 저장소를 참고해 람다에서 실행할 [app.py](http://app.py) 파일을 생성
3. 저장소를 참고해 AWS가 제공하는 파이썬 이미지를 참조하는 Dockerfile을 생성
4. Dockerfile 및 [app.py](http://app.py) 파일이 있는 폴더에 컨테이너 이미지를 빌드한다. 프로세스를 완료하는 데 몇 분이 소요된다.
5. ECR에 푸시할 수 있도록 이미지에 태그를 추가한다.
6. 이미지를 ECR 리포지토리로 푸시한다.
7. 푸시한 도커 이미지의 url을 람다의 ImageUrl 값으로 지정해 함수를 생성
8. aws lambda get-function 명령어로 람다 함수가 활성 상태에 들어간 시점을 확인할 수 있다.

<br>

**유효성 검사**

- 콘솔에서 람다를 선택한 뒤, Functions 메뉴로 이동 → 함수가 이미 이미지 유형으로 배포된것을 확인

<br>

### 정리

---

- **AWS Lambda는 컨테이너 이미지에 애플리케이션 코드를 패키징해서 배포**할 수 있는 기능을 제공
  - 이미 사용 중인 기존 빌드, 테스트, 패키지, 배포 파이프라인을 사용할 수 있다.
- 람다 함수는 컨테이너 이미지를 저장한 ECR 리포지토리와 동일한 계정에 있어야 한다.
