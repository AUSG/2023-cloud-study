# 1. ALB에서 람다 함수를 호출하도록 구성

<br>

### 실습

---

**목표**

서버리스 함수를 사용하는 애플리케이션은 로드밸런서를 통해 인터넷과 통신해야 한다.

이 애플리케이션은 특정 URL 경로의 HTTP 요청에 응답할 수 있어야 한다.

<br>

**사전 설정**

2개의 AZ에 배포된 퍼블릭 서브넷과 라우팅 테이블

ALB : 포트 80을 허용하는 보안 그룹, 포트 80을 듣는 리스너 규칙

람다 함수 실행을 위한 IAM 역할( 앞장에서 설정 )

<br>

**해결방법**

HTTP 요청에 응답할 람다 함수 생성 : `aws lambda create-function`

ALB 타켓 그룹을 생성한 뒤 다음 대상 그룹에 람다 함수를 등록

- 타켓 유형을 lambda로 설정한 ALB 대상 그룹 생성
- ELB 서비스가 람다함수를 호출할 수 있는 권한 부여 `add-permission`
- 대상 그룹에 람다 함수 등록 `aws elbv2 register targets`

타겟 그룹을 ALB의 리스너와 연결

/function 경로에 대한 트래픽을 람다함수로 보내는 리스너 규칙을 추가

<br>

**유효성 검사**

/function 경로를 호출해 람다 함수가 호출되는 것을 확인

<br><br>

### 정리

---

- 2018년에, ALB가 람다 함수를 호출하는 기능을 추가햇다.
- 최종 사용자가 ALB의 특정 URL 경로를 요청하면 ALB는 해당 요청을 람다 함수에 전달해 응답을 처리할 수있다.
- ALB는 함수의 응답을 수신하고 최종사용자에게 HTTP 응답으로 결과를 전달한다.
- ALB는 단일 로드밸런서에서 여러 경로와 대상을 가질 수 있으며 트래픽의 일부를 특정 대상(람다 함수, 컨테이너, EC2 인스턴스)으로 보낼 수 있다
- ALB는 헤더 값을 사용해 람다 함수로의 라우팅도 지원한다.
  - ALB 리스너 규칙에서 “HTTP 헤더”를 조건으로 선택한다.
  - 해당 헤더값과 일치하는 경우 람다 함수로의 라우팅 지원
- HTTP/HTTPS를 통해 노출되어야 하는 시스템을 설계할 때 단일 ALB가 애플리케이션의 모든 트래픽을 처리할 수 있는 유연성을 제공
